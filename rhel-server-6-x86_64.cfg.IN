# Kickstart file automatically generated by anaconda.

#version=DEVEL
install
cdrom
lang en_US.UTF-8
keyboard us
%include /tmp/network-include
rootpw  --iscrypted __PASSWORD__
firewall --service=ssh
authconfig --enableshadow --passalgo=sha512
selinux --enforcing
timezone --utc Europe/Amsterdam
bootloader --location=mbr --driveorder=vda --append="crashkernel=auto rhgb quiet"
# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work
clearpart --linux --drives=vda
zerombr
part /boot --fstype=ext4 --size=500
part pv.253002 --grow --size=1
volgroup VolGroup --pesize=4096 pv.253002
logvol / --fstype=ext4 --name=lv_root --vgname=VolGroup --grow --size=1024 --maxsize=51200
logvol swap --name=lv_swap --vgname=VolGroup --grow --size=2016 --maxsize=2016
user --groups=wheel --name=user1 --password=__PASSWORD__  --iscrypted --gecos="User 1"
reboot


%packages --nobase
@core
%end

%pre
if grep -q 'hostname=.*' /proc/cmdline
then

    for i in $(cat /proc/cmdline)
    do
        if echo $i | grep -q '^hostname='
        then
            eval $i
        fi
    done
    echo "network --onboot yes --device eth0 --bootproto dhcp --noipv6 --hostname=${hostname}.example.com" > /tmp/network-include
else
	echo "network --onboot yes --device eth0 --bootproto dhcp --noipv6" > /tmp/network-include
fi
%end

%post --log=/root/ks-post.log

# YUM config
mkdir /cdrom
echo "/dev/cdrom		/cdrom			iso9660	ro,loop		0 0" >> /etc/fstab
echo "[rhel-dvd]
name=Red Hat Enterprise Linux $releasever - $basearch
baseurl=file:///cdrom
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
" > /etc/yum.repos.d/rhel-dvd.repo

rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release

# SSH public key(s)
mkdir -m 0700 /root/.ssh
echo "__SSHPUBKEY__" > /root/.ssh/authorized_keys
chmod 0600 /root/.ssh/authorized_keys
restorecon -R /root/.ssh
%end
